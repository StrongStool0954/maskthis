<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>maskthis.com - Fast URL Shortener</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center p-4">
    <div class="max-w-2xl w-full">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-5xl font-bold text-gray-900 mb-2">
                üîó maskthis.com
            </h1>
            <p class="text-xl text-gray-600">
                Fast, Private URL Shortener
            </p>
            <p class="text-sm text-gray-500 mt-2">
                Global redirects in &lt;10ms ‚Ä¢ No tracking ‚Ä¢ No ads
            </p>
        </div>

        <!-- Main Card -->
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <!-- Input Form -->
            <div id="inputForm">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Enter a long URL
                </label>
                <div class="flex gap-2">
                    <input
                        type="url"
                        id="urlInput"
                        placeholder="https://example.com/very/long/url/here"
                        class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
                    >
                    <button
                        onclick="shortenURL()"
                        class="px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition"
                    >
                        Shorten
                    </button>
                </div>

                <!-- Beta Password (Required) -->
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Beta Access Password
                    </label>
                    <input
                        type="password"
                        id="betaPassword"
                        placeholder="Enter beta password"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
                    >
                    <p class="text-xs text-gray-500 mt-1">
                        üîí Service currently in private beta. Contact admin for access.
                    </p>
                </div>

                <!-- Advanced Options (collapsed) -->
                <details class="mt-4">
                    <summary class="cursor-pointer text-sm text-gray-600 hover:text-gray-900 select-none">
                        Advanced options
                    </summary>
                    <div class="mt-3 space-y-3">
                        <div>
                            <label class="block text-sm text-gray-700 mb-1">
                                Expires in (hours, optional)
                            </label>
                            <input
                                type="number"
                                id="expiresInHours"
                                placeholder="24"
                                min="1"
                                max="8760"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
                            >
                            <p class="text-xs text-gray-500 mt-1">Leave empty for permanent links</p>
                        </div>
                    </div>
                </details>
            </div>

            <!-- Result Display -->
            <div id="result" class="hidden mt-6">
                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <p class="text-sm text-green-800 font-medium mb-3">
                        ‚úÖ Your short URL is ready!
                    </p>

                    <div class="flex items-center gap-2 mb-2">
                        <input
                            type="text"
                            id="shortURL"
                            readonly
                            class="flex-1 px-4 py-2 bg-white border border-green-300 rounded-lg font-mono text-lg select-all"
                        >
                        <button
                            onclick="copyURL()"
                            id="copyButton"
                            class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition"
                        >
                            Copy
                        </button>
                    </div>

                    <p class="text-sm text-gray-600">
                        Original: <span id="originalURL" class="font-mono text-xs"></span>
                    </p>
                    <p class="text-xs text-gray-500 mt-2">
                        Clicks: <span id="clickCount">0</span> ‚Ä¢ <a href="#" id="statsLink" class="text-blue-600 hover:underline" target="_blank">View stats</a>
                    </p>
                </div>

                <button
                    onclick="resetForm()"
                    class="mt-4 text-blue-600 hover:text-blue-700 text-sm font-medium"
                >
                    ‚Üê Create another
                </button>
            </div>

            <!-- Loading State -->
            <div id="loading" class="hidden mt-6 text-center">
                <div class="animate-spin inline-block w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full"></div>
                <p class="mt-2 text-gray-600">Shortening...</p>
            </div>

            <!-- Error Display -->
            <div id="error" class="hidden mt-6 bg-red-50 border border-red-200 rounded-lg p-4">
                <p class="text-red-800" id="errorMessage"></p>
            </div>
        </div>

        <!-- Features -->
        <div class="mt-8 grid grid-cols-2 md:grid-cols-4 gap-4 text-center text-sm text-gray-600">
            <div>‚úì No tracking</div>
            <div>‚úì No ads</div>
            <div>‚úì Never expires*</div>
            <div>‚úì Global edge</div>
        </div>

        <!-- Footer -->
        <div class="mt-6 text-center text-xs text-gray-500">
            <p>Built with ‚ù§Ô∏è using Bunny Magic Containers</p>
            <p class="mt-1">* Unless you set an expiration time</p>
        </div>
    </div>

    <script>
        async function shortenURL() {
            const urlInput = document.getElementById('urlInput');
            const betaPassword = document.getElementById('betaPassword').value.trim();
            const expiresInHours = document.getElementById('expiresInHours').value;
            const url = urlInput.value.trim();

            if (!url) {
                showError('Please enter a URL');
                return;
            }

            // Basic URL validation
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                showError('URL must start with http:// or https://');
                return;
            }

            if (!betaPassword) {
                showError('Please enter your beta password');
                return;
            }

            // Show loading
            document.getElementById('inputForm').classList.add('hidden');
            document.getElementById('result').classList.add('hidden');
            document.getElementById('error').classList.add('hidden');
            document.getElementById('loading').classList.remove('hidden');

            try {
                const response = await fetch('/api/shorten', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Beta-Password': betaPassword
                    },
                    body: JSON.stringify({
                        url: url,
                        expires_in_hours: expiresInHours ? parseInt(expiresInHours) : 0
                    })
                });

                const data = await response.json();

                if (data.success) {
                    // Show result
                    document.getElementById('shortURL').value = data.short_url;
                    document.getElementById('originalURL').textContent = truncate(data.long_url, 60);
                    document.getElementById('statsLink').href = '/api/stats/' + data.short_code;
                    document.getElementById('loading').classList.add('hidden');
                    document.getElementById('result').classList.remove('hidden');
                } else {
                    showError(data.error || 'Failed to shorten URL');
                }
            } catch (error) {
                showError('Network error: ' + error.message);
            }
        }

        function copyURL() {
            const shortURL = document.getElementById('shortURL');
            shortURL.select();
            shortURL.setSelectionRange(0, 99999); // For mobile devices

            navigator.clipboard.writeText(shortURL.value).then(() => {
                // Visual feedback
                const btn = document.getElementById('copyButton');
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                btn.classList.remove('bg-green-600', 'hover:bg-green-700');
                btn.classList.add('bg-gray-600');

                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.classList.remove('bg-gray-600');
                    btn.classList.add('bg-green-600', 'hover:bg-green-700');
                }, 2000);
            }).catch(err => {
                // Fallback for older browsers
                document.execCommand('copy');
            });
        }

        function resetForm() {
            document.getElementById('urlInput').value = '';
            document.getElementById('expiresInHours').value = '';
            // Keep beta password so user doesn't have to re-enter it
            document.getElementById('result').classList.add('hidden');
            document.getElementById('inputForm').classList.remove('hidden');
            document.getElementById('urlInput').focus();
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('error').classList.remove('hidden');
            document.getElementById('inputForm').classList.remove('hidden');
        }

        function truncate(str, len) {
            return str.length > len ? str.substring(0, len) + '...' : str;
        }

        // Allow Enter key to submit
        document.getElementById('urlInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') shortenURL();
        });

        document.getElementById('betaPassword').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') shortenURL();
        });

        // Focus on input when page loads
        window.addEventListener('load', () => {
            document.getElementById('urlInput').focus();
        });
    </script>
</body>
</html>
